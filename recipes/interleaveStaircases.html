<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Coder - interleave staircases &mdash; PsychoPy v1.8</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.84.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="PsychoPy v1.8" href="../index.html" />
    <link rel="up" title="Recipes (“How-to”s)" href="recipes.html" />
    <link rel="next" title="Making isoluminant stimuli" href="isoluminance.html" />
    <link rel="prev" title="Generating formatted strings" href="formattedStrings.html" /> 
  </head>
  <body>


<div id="header"  style="background-color: white">
<table width="100%" cellpadding="10">
<tr><td style="text-align:left;vertical-align:middle">
<a href='http://www.psychopy.org'><img src="../_static/psychopyDocBanner2.gif" alt="PsychoPy logo" /></a>
</td><td style="text-align:right;vertical-align:middle">
<a href='http://www.nottingham.ac.uk'><img src="../_static/nott_logo.png" alt="University of Nottingham" /></a>
</td></table>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="isoluminance.html" title="Making isoluminant stimuli"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="formattedStrings.html" title="Generating formatted strings"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">PsychoPy</a> &raquo;</li>
          <li><a href="../documentation.html" >Documentation</a> &raquo;</li>
          <li><a href="recipes.html" accesskey="U">Recipes (&#8220;How-to&#8221;s)</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h4>Previous topic</h4>
            <p class="topless"><a href="formattedStrings.html"
                                  title="previous chapter">Generating formatted strings</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="isoluminance.html"
                                  title="next chapter">Making isoluminant stimuli</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/recipes/interleaveStaircases.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>

            <h3>Quick links</h3>
            <ul>
            <li><a href="https://github.com/psychopy/psychopy/releases"><strong>Download</strong></a></li>
            <li><a href="http://groups.google.com/group/psychopy-users">Mailing list (users)</a></li>
            <li><a href="http://twitter.com/psychopy">Twitter</a></li>
            </ul>

            <!-- facebook like -->
            <div id="fb-root"></div><script src="http://connect.facebook.net/en_US/all.js#appId=122767831154831&amp;xfbml=1"></script>
            <fb:like href="http://www.facebook.com/pages/PsychoPy/140222406067597" send="false" layout="button_count" width="300" show_faces="false" action="like" font=""></fb:like>

            <!-- google +1 -->
            <!-- Place this tag where you want the +1 button to render -->
            <g:plusone count="false" href="http://www.psychopy.org"></g:plusone>
            <!-- Place this tag after the last plusone tag -->
            <script type="text/javascript">
              window.___gcfg = {lang: 'en-GB'};
              (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
              })();
            </script>

          <div id="searchbox" style="display: none">
            <h3>Searches</h3>
            <form action="http://www.google.com/cse" id="cse-search-box">
                <input type="hidden" name="cx" value="partner-pub-0861691574026297:eyw5n7-ugep" />
                <input type="hidden" name="ie" value="ISO-8859-1" />
                <input type="text" name="q" size="20" />
                <input type="submit" name="sa" value="Go" />
            </form>
              <p class="searchtip" style="font-size: 90%">
              General
              </p>
            <script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Docs only
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="coder-interleave-staircases">
<span id="interleavedstairs"></span><h1>Coder - interleave staircases<a class="headerlink" href="#coder-interleave-staircases" title="Permalink to this headline">¶</a></h1>
<p>Often psychophysicists using staircase procedures want to interleave multiple staircases, either with different start points, or for different conditions.</p>
<p>There is now a class, <a class="reference internal" href="../api/data.html#psychopy.data.MultiStairHandler" title="psychopy.data.MultiStairHandler"><code class="xref py py-class docutils literal"><span class="pre">psychopy.data.MultiStairHandler</span></code></a> to allow simple access to interleaved staircases of either basic or QUEST types. That can also be used from the <a class="reference internal" href="../builder/flow.html#loops"><span>Loops</span></a> in the <a class="reference internal" href="../builder/builder.html#builder"><span>Builder</span></a>. The following method allows the same to be created in your own code, for greater options.</p>
<p>The method works by nesting a pair of loops, one to loop through the number of trials and another to loop across the staircases. The staircases can be shuffled between trials, so that they do not simply alternate.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note the need to create a <em>copy</em> of the info. If you simply do <cite>thisInfo=info</cite> then all your staircases will end up pointing to the same object, and when you change the info in the final one, you will be changing it for all.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">psychopy</span> <span class="kn">import</span> <span class="n">visual</span><span class="p">,</span> <span class="n">core</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">event</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">import</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">time</span> <span class="c">#from the std python libs</span>

<span class="c">#create some info to store with the data</span>
<span class="n">info</span><span class="o">=</span><span class="p">{}</span>
<span class="n">info</span><span class="p">[</span><span class="s">&#39;startPoints&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">info</span><span class="p">[</span><span class="s">&#39;nTrials&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">10</span>
<span class="n">info</span><span class="p">[</span><span class="s">&#39;observer&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;jwp&#39;</span>

<span class="n">win</span><span class="o">=</span><span class="n">visual</span><span class="o">.</span><span class="n">Window</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span><span class="mi">400</span><span class="p">])</span>
<span class="c">#---------------------</span>
<span class="c">#create the stimuli</span>
<span class="c">#---------------------</span>

<span class="c">#create staircases</span>
<span class="n">stairs</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">thisStart</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;startPoints&#39;</span><span class="p">]:</span>
    <span class="c">#we need a COPY of the info for each staircase </span>
    <span class="c">#(or the changes here will be made to all the other staircases)</span>
    <span class="n">thisInfo</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="c">#now add any specific info for this staircase</span>
    <span class="n">thisInfo</span><span class="p">[</span><span class="s">&#39;thisStart&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">thisStart</span> <span class="c">#we might want to keep track of this</span>
    <span class="n">thisStair</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">StairHandler</span><span class="p">(</span><span class="n">startVal</span><span class="o">=</span><span class="n">thisStart</span><span class="p">,</span> 
        <span class="n">extraInfo</span><span class="o">=</span><span class="n">thisInfo</span><span class="p">,</span>
        <span class="n">nTrials</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">nUp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nDown</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">minVal</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">maxVal</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> 
        <span class="n">stepSizes</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisStair</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">trialN</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;nTrials&#39;</span><span class="p">]):</span>
    <span class="n">shuffle</span><span class="p">(</span><span class="n">stairs</span><span class="p">)</span> <span class="c">#this shuffles &#39;in place&#39; (ie stairs itself is changed, nothing returned)</span>
    <span class="c">#then loop through our randomised order of staircases for this repeat</span>
    <span class="k">for</span> <span class="n">thisStair</span> <span class="ow">in</span> <span class="n">stairs</span><span class="p">:</span>
        <span class="n">thisIntensity</span> <span class="o">=</span> <span class="n">thisStair</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39;start=</span><span class="si">%.2f</span><span class="s">, current=</span><span class="si">%.4f</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">thisStair</span><span class="o">.</span><span class="n">extraInfo</span><span class="p">[</span><span class="s">&#39;thisStart&#39;</span><span class="p">],</span> <span class="n">thisIntensity</span><span class="p">)</span>
        
        <span class="c">#---------------------</span>
        <span class="c">#run your trial and get an input</span>
        <span class="c">#---------------------</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">waitKeys</span><span class="p">()</span> <span class="c">#(we can simulate by pushing left for &#39;correct&#39;)</span>
        <span class="k">if</span> <span class="s">&#39;left&#39;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span> <span class="n">wasCorrect</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">wasCorrect</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="n">thisStair</span><span class="o">.</span><span class="n">addData</span><span class="p">(</span><span class="n">wasCorrect</span><span class="p">)</span> <span class="c">#so that the staircase adjusts itself</span>
        
    <span class="c">#this trial (of all staircases) has finished</span>
<span class="c">#all trials finished</span>
        
<span class="c">#save data (separate pickle and txt files for each staircase)</span>
<span class="n">dateStr</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%b_</span><span class="si">%d</span><span class="s">_%H%M&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span><span class="c">#add the current time</span>
<span class="k">for</span> <span class="n">thisStair</span> <span class="ow">in</span> <span class="n">stairs</span><span class="p">:</span>
    <span class="c">#create a filename based on the subject and start value</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> start</span><span class="si">%.2f</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">thisStair</span><span class="o">.</span><span class="n">extraInfo</span><span class="p">[</span><span class="s">&#39;observer&#39;</span><span class="p">],</span> <span class="n">thisStair</span><span class="o">.</span><span class="n">extraInfo</span><span class="p">[</span><span class="s">&#39;thisStart&#39;</span><span class="p">],</span> <span class="n">dateStr</span><span class="p">)</span>
    <span class="n">thisStair</span><span class="o">.</span><span class="n">saveAsPickle</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">thisStair</span><span class="o">.</span><span class="n">saveAsText</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>   
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="isoluminance.html" title="Making isoluminant stimuli"
             >next</a> |</li>
        <li class="right" >
          <a href="formattedStrings.html" title="Generating formatted strings"
             >previous</a> |</li>
        <li><a href="../index.html">PsychoPy</a> &raquo;</li>
          <li><a href="../documentation.html" >Documentation</a> &raquo;</li>
          <li><a href="recipes.html" >Recipes (&#8220;How-to&#8221;s)</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2015, Jonathan Peirce.
      Last updated on Mar 30, 2016.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.3.
    <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        var pageTracker = _gat._getTracker("UA-4089651-2");
        pageTracker._initData();
        pageTracker._trackPageview();
    </script>

    <script type="text/javascript" src="http://www.ohloh.net/p/17081/widgets/project_partner_badge.js"></script>
    </div>
  </body>
</html>